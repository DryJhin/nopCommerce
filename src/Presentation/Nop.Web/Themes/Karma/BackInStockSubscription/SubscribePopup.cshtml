@model BackInStockSubscribeModel

<section class="d-flex align-content-center justify-content-center pl-3">
    <div class="row">
        <h3 class="text-center">
            @if (Model.AlreadySubscribed)
            {
                @T("BackInStockSubscriptions.AlreadySubscribed")
            }
            else
            {
                @T("BackInStockSubscriptions.PopupTitle")
            }
        </h3>
        <div class="row mt-3">
            @if (!Model.SubscriptionAllowed)
            {
                <h5 class="text-center">
                    @T("BackInStockSubscriptions.NotAllowed")
                </h5>
            }
            else if (!Model.IsCurrentCustomerRegistered)
            {
                <h5 class="text-center">
                    @T("BackInStockSubscriptions.OnlyRegistered")
                </h5>
            }
            else if (!Model.AlreadySubscribed && Model.CurrentNumberOfBackInStockSubscriptions >= Model.MaximumBackInStockSubscriptions)
            {
                <h5 class="text-center">
                    @string.Format(T("BackInStockSubscriptions.MaxSubscriptions").Text, Model.MaximumBackInStockSubscriptions)
                </h5>
            }
            else
            {
                if (!Model.AlreadySubscribed)
                {
                    <h5 class="tooltip text-center">@T("BackInStockSubscriptions.Tooltip")</h5>
                }
                <button type="submit" id="back-in-stock-notify-me" class="primary-btn">
                    @(Model.AlreadySubscribed ? @T("BackInStockSubscriptions.Unsubscribe").Text : @T("BackInStockSubscriptions.NotifyMe").Text)
                </button>
                <script>
                $(document).ready(function () {
                    $("#back-in-stock-notify-me").on('click', function () {
                        var subscribeButton = this;
                        $.ajax({
                            cache: false,
                            type: "POST",
                            url: "@(Url.RouteUrl("BackInStockSubscribeSend"))",
                            data: {
                                "productId": '@Model.ProductId'
                            },
                            success: function (data, textStatus, jqXHR) {
                                $(subscribeButton).closest('.ui-dialog-content').dialog('destroy').remove();
                            },
                            error: function (jqXHR, textStatus, errorThrown) {
                                alert('Failed to change subscription.');
                            }
                        });

                    });
                });
                </script>
            }
        </div>
    </div>
</section>